@if (isOpen) {
  <div class="fixed inset-0 z-50 flex items-end lg:items-center justify-center">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" (click)="onBackdropClick()"></div>
    <div class="relative bg-white dark:bg-gray-800 rounded-t-3xl lg:rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
      @if (!isSuccess()) {
        <!-- Header -->
        <div class="sticky top-0 bg-white dark:bg-gray-800 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-bold text-gray-900 dark:text-white">Saya Menemukan Barang Ini</h2>
              <p class="text-sm text-gray-500 dark:text-gray-400">Jawab pertanyaan untuk verifikasi</p>
            </div>
            <button 
              (click)="onClose()"
              class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="ph ph-x text-xl text-gray-500"></i>
            </button>
          </div>
        </div>

        <!-- Form -->
        <div class="p-6 space-y-5">
          <div class="p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl">
            <p class="text-sm text-orange-700 dark:text-orange-400">
              <i class="ph ph-info"></i> Jawab pertanyaan dari pemilik dengan jujur. Kontak pemilik akan ditampilkan setelah diverifikasi.
            </p>
          </div>

          <!-- Verification Questions -->
          <div class="space-y-4">
            @for (answer of answers; track answer.questionId; let i = $index) {
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  {{ answer.question }}
                  @if (isQuestionRequired(i)) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <textarea
                  [(ngModel)]="answer.answer"
                  rows="2"
                  [placeholder]="'Jawab pertanyaan ini...'"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-uii-orange focus:border-transparent resize-none"></textarea>
              </div>
            }
          </div>

          <!-- Photo Evidence (Optional) -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Foto Bukti <span class="text-gray-400 font-normal">(Opsional)</span>
            </label>
            @if (!photoPreview) {
              <label class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition">
                <i class="ph ph-camera text-3xl text-gray-400 mb-2"></i>
                <span class="text-sm text-gray-500">Upload foto barang yang ditemukan</span>
                <input type="file" accept="image/*" class="hidden" (change)="onPhotoSelect($event)">
              </label>
            } @else {
              <div class="relative">
                <img [src]="photoPreview" alt="Preview" class="w-full h-48 object-cover rounded-xl">
                <button 
                  type="button"
                  (click)="removePhoto()"
                  class="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition">
                  <i class="ph ph-x"></i>
                </button>
              </div>
            }
          </div>

          <!-- Additional Contact (Optional) -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Kontak Tambahan <span class="text-gray-400 font-normal">(Opsional)</span>
            </label>
            <input 
              type="text"
              [(ngModel)]="additionalContact"
              placeholder="Instagram, Line, Email, dll (agar pemilik mudah menghubungi Anda)"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-uii-orange focus:border-transparent">
          </div>

          <!-- Submit Button -->
          <button 
            (click)="onSubmit()"
            [disabled]="!canSubmit() || isSubmitting()"
            class="w-full py-4 px-6 bg-uii-orange text-white font-semibold rounded-xl hover:bg-uii-orange/90 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
            @if (isSubmitting()) {
              <i class="ph ph-spinner animate-spin"></i>
              Mengirim...
            } @else {
              <i class="ph ph-paper-plane-tilt"></i>
              Kirim Verifikasi
            }
          </button>

          <button 
            (click)="onClose()"
            class="w-full py-3 px-6 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition">
            Batal
          </button>
        </div>
      } @else {
        <!-- Success State -->
        <div class="p-6">
          <div class="text-center py-6">
            <div class="w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="ph-fill ph-check-circle text-5xl text-green-500"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Verifikasi Terkirim!</h3>
            <p class="text-gray-500 dark:text-gray-400 mb-6">
              Pemilik akan memeriksa jawaban Anda. 
              Anda akan mendapatkan notifikasi setelah pemilik memverifikasi.
            </p>
            <button 
              (click)="onClose()"
              class="w-full py-4 px-6 bg-uii-orange text-white font-semibold rounded-xl hover:bg-uii-orange/90 transition">
              Tutup
            </button>
          </div>
        </div>
      }
    </div>
  </div>
}
