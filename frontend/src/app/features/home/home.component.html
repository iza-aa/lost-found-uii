<div class="container mx-auto px-4 py-6 pb-24 md:pb-6">
  
  <!-- Search Bar -->
  <div class="mb-6">
    <app-search-bar 
      [(value)]="searchQuery"
      (search)="onSearchChange()"
      placeholder="Cari barang hilang...">
    </app-search-bar>
  </div>

  <!-- Category Filter -->
  <div class="mb-6 -mx-4 px-4">
    <app-category-filter
      [categories]="categories"
      [selectedCategory]="selectedCategory"
      (categoryChange)="selectCategory($event)">
    </app-category-filter>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
      @for (i of [1,2,3,4,5,6,7,8]; track i) {
        <!-- Skeleton Card -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden animate-pulse">
          <!-- Image Skeleton -->
          <div class="h-40 bg-gray-200 dark:bg-gray-700"></div>
          <!-- Content Skeleton -->
          <div class="p-4 space-y-3">
            <div class="h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div>
            <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-full"></div>
            <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"></div>
            <div class="flex items-center gap-2">
              <div class="h-6 w-16 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
              <div class="h-4 w-20 bg-gray-200 dark:bg-gray-700 rounded"></div>
            </div>
            <div class="flex gap-3">
              <div class="h-4 w-16 bg-gray-200 dark:bg-gray-700 rounded"></div>
              <div class="h-4 w-16 bg-gray-200 dark:bg-gray-700 rounded"></div>
            </div>
          </div>
        </div>
      }
    </div>
  } @else if (errorMessage()) {
    <!-- Error State -->
    <div class="text-center py-12">
      <div class="w-20 h-20 mx-auto mb-4 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
        <i class="ph ph-warning-circle text-4xl text-red-500"></i>
      </div>
      <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Gagal Memuat Data</h3>
      <p class="text-gray-500 dark:text-gray-400 mb-4">{{ errorMessage() }}</p>
      <button 
        (click)="loadItems()"
        class="px-6 py-2 bg-uii-blue text-white rounded-lg hover:bg-uii-blue/90 transition">
        <i class="ph ph-arrow-clockwise mr-2"></i>Coba Lagi
      </button>
    </div>
  } @else {
    <!-- Results Count & Items Per Page (Desktop only) -->
    @if (filteredItems.length > 0) {
      <div class="hidden md:flex justify-between items-center mb-4">
        <p class="text-gray-600 dark:text-gray-400 text-sm">
          Menampilkan <span class="font-semibold text-gray-800 dark:text-white">{{ itemRangeStart }}-{{ itemRangeEnd }}</span> 
          dari <span class="font-semibold text-gray-800 dark:text-white">{{ filteredItems.length }}</span> barang
        </p>
        
        <!-- Items per page -->
        <div class="flex items-center gap-2">
          <span class="text-gray-500 dark:text-gray-400 text-sm">Tampilkan:</span>
          <select 
            [(ngModel)]="itemsPerPage" 
            (ngModelChange)="changeItemsPerPage($event)"
            class="border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-uii-blue dark:focus:ring-uii-gold">
            @for (option of itemsPerPageOptions; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
        </div>
      </div>
    }

    <!-- Items Grid -->
    @if (filteredItems.length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        @for (item of paginatedItems; track item.id) {
          <app-item-card [item]="item"></app-item-card>
        }
      </div>
    }

    <!-- Empty State -->
    @if (filteredItems.length === 0) {
      <app-empty-state 
        icon="ph-magnifying-glass"
        title="Tidak ada barang ditemukan"
        message="Coba ubah kata kunci atau filter pencarian">
      </app-empty-state>
    }

    <!-- Pagination -->
    @if (totalPages > 1) {
      <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
        
        <!-- Pagination Controls -->
        <div class="flex items-center gap-1">
          <!-- Previous Button -->
          <button 
            (click)="prevPage()"
            [disabled]="currentPage === 1"
            [class]="currentPage === 1 ? 'text-gray-300 dark:text-gray-600 cursor-not-allowed' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'"
            class="p-2 rounded-lg transition">
            <i class="ph ph-caret-left text-xl"></i>
          </button>

          <!-- Page Numbers -->
          @for (page of pageNumbers; track $index) {
            @if (page === -1) {
              <span class="px-2 text-gray-400 dark:text-gray-600">...</span>
            } @else {
              <button 
                (click)="goToPage(page)"
                [class]="currentPage === page 
                  ? 'bg-uii-blue dark:bg-uii-gold text-white dark:text-uii-blue' 
                  : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'"
                class="w-10 h-10 rounded-lg font-medium transition">
                {{ page }}
              </button>
            }
          }

          <!-- Next Button -->
          <button 
            (click)="nextPage()"
            [disabled]="currentPage === totalPages"
            [class]="currentPage === totalPages ? 'text-gray-300 dark:text-gray-600 cursor-not-allowed' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800'"
            class="p-2 rounded-lg transition">
            <i class="ph ph-caret-right text-xl"></i>
          </button>
        </div>

      </div>
    }
  }

</div>
