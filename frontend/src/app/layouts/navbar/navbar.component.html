<nav class="bg-uii-blue text-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3">
    
    <!-- 3 Column Grid Layout -->
    <div class="flex items-center justify-between md:grid md:grid-cols-3">
      
      <!-- Left: Logo -->
      <a routerLink="/" class="flex items-center gap-2">
        <img src="/assets/LogoUII.png" alt="Logo UII" class="w-10 h-auto object-contain">
        <div class="text-xl font-bold tracking-tight">
          Lost<span class="text-uii-gold">&</span>Found
        </div>
      </a>
      
      <!-- Center: Desktop Menu -->
      <div class="hidden md:flex justify-center space-x-8 items-center font-medium text-sm">
        <a routerLink="/" routerLinkActive="text-uii-gold border-uii-gold" [routerLinkActiveOptions]="{exact: true}" 
           class="hover:text-uii-gold transition border-b-2 border-transparent hover:border-uii-gold py-1">
          Beranda
        </a>
        <a routerLink="/notification" routerLinkActive="text-uii-gold border-uii-gold" 
           class="hover:text-uii-gold transition border-b-2 border-transparent hover:border-uii-gold py-1">
          Notifikasi
        </a>
        <a routerLink="/radar" routerLinkActive="text-uii-gold border-uii-gold" 
           class="hover:text-uii-gold transition border-b-2 border-transparent hover:border-uii-gold py-1">
          Radar
        </a>
        @if (isAuthenticated()) {
          <a routerLink="/profile" routerLinkActive="text-uii-gold border-uii-gold" 
             class="hover:text-uii-gold transition border-b-2 border-transparent hover:border-uii-gold py-1">
            Akun
          </a>
        }
      </div>

      <!-- Right: Action Buttons -->
      <div class="flex items-center justify-end gap-2 md:gap-3">
        
        <!-- QR Scanner Button -->
        <button 
          (click)="openQRScanner()"
          class="relative p-2 rounded-lg hover:bg-white/10 transition"
          title="Scan QR">
          <i class="ph ph-qr-code text-2xl"></i>
        </button>



        <!-- User Menu / Login Button (Desktop Only) -->
        @if (isAuthenticated()) {
          <!-- User Avatar with Dropdown - Hidden on Mobile -->
          <div class="relative hidden md:block">
            <button 
              (click)="toggleUserMenu()"
              class="flex items-center gap-2 p-1 rounded-lg hover:bg-white/10 transition">
              <img 
                [src]="currentUser()?.avatar || 'https://i.pravatar.cc/150'" 
                [alt]="currentUser()?.name"
                class="w-8 h-8 rounded-full object-cover border-2 border-white/30"
              >
              <i class="ph ph-caret-down text-sm"></i>
            </button>

            <!-- Dropdown Menu -->
            @if (showUserMenu) {
              <div 
                class="absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-lg py-2 z-50"
                (mouseleave)="closeUserMenu()">
                <!-- User Info -->
                <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700">
                  <p class="font-medium text-gray-900 dark:text-white">{{ currentUser()?.name }}</p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">{{ currentUser()?.email }}</p>
                  <!-- Badge -->
                  <div class="mt-2">
                    @switch (currentUser()?.badge) {
                      @case ('gold') {
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs rounded-full">
                          <i class="ph-fill ph-seal-check"></i> Staff UII
                        </span>
                      }
                      @case ('blue') {
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs rounded-full">
                          <i class="ph-fill ph-student"></i> Mahasiswa UII
                        </span>
                      }
                      @default {
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs rounded-full">
                          <i class="ph ph-user"></i> Umum
                        </span>
                      }
                    }
                  </div>
                </div>
                
                <!-- Menu Items -->
                <a routerLink="/profile" 
                   (click)="closeUserMenu()"
                   class="flex items-center gap-3 px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="ph ph-user-circle text-lg"></i>
                  <span>Profil Saya</span>
                </a>
                <a routerLink="/post-item" 
                   (click)="closeUserMenu()"
                   class="flex items-center gap-3 px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="ph ph-file-text text-lg"></i>
                  <span>Laporan Saya</span>
                </a>
                <hr class="my-2 border-gray-100 dark:border-gray-700">
                <button 
                  (click)="logout()"
                  class="flex items-center gap-3 px-4 py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 w-full">
                  <i class="ph ph-sign-out text-lg"></i>
                  <span>Keluar</span>
                </button>
              </div>
            }
          </div>

          <!-- Lapor Barang Button (Desktop only) -->
          <a routerLink="/post-item" 
             class="hidden md:flex bg-uii-gold text-uii-blue px-4 py-2 rounded-lg font-semibold hover:bg-yellow-400 transition items-center gap-2 leading-none">
            <i class="ph ph-plus-circle text-lg leading-none"></i>
            <span class="leading-none mb-[3px]">Lapor</span>
          </a>
        } @else {
          <!-- Login Button -->
          <a routerLink="/login" 
             class="flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg font-medium transition">
            <i class="ph ph-sign-in text-lg"></i>
            <span class="hidden sm:inline">Masuk</span>
          </a>
        }

      </div>

    </div>
  </div>
</nav>

<!-- QR Scanner Modal -->
@if (showQRScanner()) {
  <app-qr-scanner
    (scanSuccess)="onQRScanSuccess($event)"
    (scanError)="onQRScanError($event)"
    (close)="closeQRScanner()">
  </app-qr-scanner>
}