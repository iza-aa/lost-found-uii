<div class="fixed inset-0 z-[3000] bg-black">
  <!-- Header -->
  <div class="absolute top-0 left-0 right-0 z-10 flex items-center justify-between px-4 py-4 bg-gradient-to-b from-black/70 to-transparent">
    <button 
      (click)="onClose()"
      class="w-10 h-10 flex items-center justify-center rounded-full bg-white/20 text-white hover:bg-white/30 transition">
      <i class="ph ph-x text-xl"></i>
    </button>
    <span class="text-white font-medium">Scan QR Code</span>
    <div class="w-10"></div>
  </div>

  <!-- Scanner Area -->
  <div class="absolute inset-0 flex items-center justify-center">
    @if (isLoading()) {
      <div class="text-center text-white">
        <div class="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-4"></div>
        <p>Memuat kamera...</p>
      </div>
    }

    @if (hasError()) {
      <div class="text-center text-white px-6">
        <div class="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="ph ph-camera-slash text-4xl text-red-400"></i>
        </div>
        <p class="text-lg font-medium mb-2">Kamera Error</p>
        <p class="text-sm text-gray-300 mb-6">{{ errorMessage() }}</p>
        <button 
          (click)="retryScanner()"
          class="px-6 py-3 bg-white text-gray-900 font-medium rounded-xl hover:bg-gray-100 transition">
          <i class="ph ph-arrow-clockwise mr-2"></i>
          Coba Lagi
        </button>
      </div>
    }

    <!-- QR Reader Container -->
    <div 
      id="qr-reader" 
      class="w-full h-full"
      [class.hidden]="isLoading() || hasError()">
    </div>

    <!-- Viewfinder Overlay -->
    @if (!isLoading() && !hasError()) {
      <div class="absolute inset-0 pointer-events-none">
        <!-- Dark overlay with transparent center -->
        <div class="absolute inset-0 bg-black/50"></div>
        
        <!-- Transparent scanning area -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64">
          <!-- Cut out the center -->
          <div class="absolute inset-0 bg-transparent shadow-[0_0_0_9999px_rgba(0,0,0,0.5)]"></div>
          
          <!-- Corner marks -->
          <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-white rounded-tl-lg"></div>
          <div class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-white rounded-tr-lg"></div>
          <div class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-white rounded-bl-lg"></div>
          <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-white rounded-br-lg"></div>
          
          <!-- Scanning line animation -->
          <div class="absolute left-2 right-2 h-0.5 bg-uii-gold animate-scan-line"></div>
        </div>
      </div>
    }
  </div>

  <!-- Instructions -->
  @if (!isLoading() && !hasError()) {
    <div class="absolute bottom-32 left-0 right-0 text-center text-white px-4">
      <p class="text-sm">Arahkan kamera ke QR Code</p>
    </div>
  }

  <!-- Bottom Controls -->
  @if (!isLoading() && !hasError()) {
    <div class="absolute bottom-0 left-0 right-0 z-10 flex items-center justify-center gap-8 px-4 py-8 bg-gradient-to-t from-black/70 to-transparent">
      <!-- Flash Toggle -->
      <button 
        (click)="toggleFlash()"
        class="w-14 h-14 flex flex-col items-center justify-center rounded-full bg-white/20 text-white hover:bg-white/30 transition"
        [class.bg-yellow-500]="isFlashOn()"
        [class.text-gray-900]="isFlashOn()">
        <i [class]="isFlashOn() ? 'ph-fill ph-lightning text-2xl' : 'ph ph-lightning text-2xl'"></i>
      </button>

      <!-- Switch Camera -->
      <button 
        (click)="toggleCamera()"
        class="w-14 h-14 flex flex-col items-center justify-center rounded-full bg-white/20 text-white hover:bg-white/30 transition">
        <i class="ph ph-camera-rotate text-2xl"></i>
      </button>
    </div>
  }
</div>
